device_type: hi6220-hikey
job_name: hi6220-hikey
timeouts:
  job:
    minutes: 60
  action:
    minutes: 15
  connection:
    minutes: 2
priority: medium
visibility: public

metadata:
  source: https://git.linaro.org/lava-team/refactoring.git
  path: hi6220-hikey.yaml

actions:
# DEPLOY_TARGET_BLOCK
- deploy:
    docker:
        local: true
        image: lavalabteam/adb-fastboot
    timeout:
      minutes: 15
    to: fastboot
    images:
      ptable:
        url: http://example.com/hikey/ptable-aosp-8g.img
        reboot: hard-reset
      boot:
        url: http://example.com/hikey/boot.img.xz
        compression: xz
        reboot: hard-reset
      cache:
        url: http://example.com/hikey/cache.img.xz
        compression: xz
      userdata:
        url: http://example.com/hikey/userdata.img.xz
        compression: xz
      system:
        url: http://example.com/hikey/system.img.xz
        sha256sum: e0e82b5adfae84ff97f4f6488e5b4c64b0dfc7ad8a37b4bcbb887d9f85a6be0a
        compression: xz

# BOOT_TARGET_BLOCK
- boot:
    docker:
        local: true
        image: lavalabteam/adb-fastboot
    prompts:
    - 'root@(.*):/#'
    - 'hikey:/'
    timeout:
      minutes: 15
    method: fastboot

- test:
    docker:
        local: true
        image: lavalabteam/adb-fastboot
    timeout:
      minutes: 10
    definitions:
    - repository: https://git.linaro.org/lava-team/refactoring.git/
      from: git
      path: android/lava-android-basic.yaml
      name: v2-make-adb-connection
